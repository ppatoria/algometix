<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=35947&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Explore cache hierarchy and shared caching in multi-core architectures, including key challenges like cache coherence and false sharing.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:35947/blog/cpu_cache/multicore-caching/cache-hierarchy/">
  <meta property="og:site_name" content="Algometix">
  <meta property="og:title" content="Cache Hierarchy and Sharing">
  <meta property="og:description" content="Explore cache hierarchy and shared caching in multi-core architectures, including key challenges like cache coherence and false sharing.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-02-06T22:45:00+00:00">
    <meta property="article:modified_time" content="2025-02-06T22:45:00+00:00">
    <meta property="article:tag" content="C&#43;&#43;">
    <meta property="article:tag" content="Performance Optimization">
    <meta property="article:tag" content="Low-Latency Programming">
    <meta property="article:tag" content="Cache Optimization">
    <meta property="article:tag" content="Multi-Core Architecture">
    <meta property="article:tag" content="Cache Hierarchy">
<title>Cache Hierarchy and Sharing | Algometix</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:35947/blog/cpu_cache/multicore-caching/cache-hierarchy/">
<link rel="stylesheet" href="/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css" integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.e678bcaf0da1661a6c2e5b25f35692c64ed2de47dff88a57226649ac329f6cf4.js" integrity="sha256-5ni8rw2hZhpsLlsl81aSxk7S3kff&#43;IpXImZJrDKfbPQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Algometix</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/" class="">CPU Cache: Organization, Optimization and Challenges</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/cache-optimization/" class="">Cache Optimization Techniques</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/cache-optimization/cache-optimization-focusing-on-data-alignment/" class="">Data Alignment: Enhancing Contiguous Data Processing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/cache-optimization/cache-optimization-through-prefetching/" class="">Cache Prefetching: Enhancing Non-Contiguous Data Processing</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/" class="">Multi-Core Caching Techniques</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/cache-hierarchy/" class="active">Cache Hierarchy and Sharing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/cache_coherence_protocols/" class="">Cache Coherence and Protocols</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/false-sharing/" class="">False Sharing</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/false-sharing/false_sharing_adjacent_variables/" class="">Impact of Adjacent Variable Modification</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/cache_coherence_protocols_deepseek/" class="">Cache Coherence Protocols Deepseek</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/multicore-caching/cache_coherence_protocols_gemini/" class="">Cache Coherence Protocols Gemini</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/singlecore-caching/cache_coherence/" class="">Cache Coherence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/singlecore-caching/gemini_singlecore_multicore/" class="">Gemini Singlecore Multicore</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/singlecore-caching/reordeing/" class="">Reordeing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/blog/cpu_cache/singlecore-caching/single-multi-core-deepseek/" class="">Single Multi Core Deepseek</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Cache Hierarchy and Sharing</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#cache-hierarchy-and-sharing-in-multi-processor-machines"><strong>Cache Hierarchy and Sharing in Multi-Processor Machines</strong></a>
      <ul>
        <li><a href="#typical-cache-hierarchy">Typical Cache Hierarchy</a></li>
        <li><a href="#single-core-vs-multi-core-architecture">Single-Core vs Multi-Core Architecture</a></li>
        <li><a href="#checking-your-cpus-cache-configuration">Checking Your CPU&rsquo;s Cache Configuration</a></li>
        <li><a href="#cache-sharing-and-potential-issues">Cache Sharing and Potential Issues</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h2 id="cache-hierarchy-and-sharing-in-multi-processor-machines">
  <strong>Cache Hierarchy and Sharing in Multi-Processor Machines</strong>
  <a class="anchor" href="#cache-hierarchy-and-sharing-in-multi-processor-machines">#</a>
</h2>
<h3 id="typical-cache-hierarchy">
  Typical Cache Hierarchy
  <a class="anchor" href="#typical-cache-hierarchy">#</a>
</h3>
<p>In multi-core processors, the cache hierarchy plays a crucial role in improving performance by minimizing the time taken to access frequently used data. Here&rsquo;s a breakdown of the typical cache levels:</p>
<ol>
<li><strong>L1 Cache</strong>: The smallest and fastest cache, private to each core.</li>
<li><strong>L2 Cache</strong>: Larger than L1, usually private to each core but can also be shared in some systems.</li>
<li><strong>L3 Cache</strong>: The largest cache, shared across all cores in the processor.</li>
<li><strong>Main Memory (RAM)</strong>: The largest and slowest storage layer, accessed when data is not found in the caches.</li>
</ol>
<h3 id="single-core-vs-multi-core-architecture">
  Single-Core vs Multi-Core Architecture
  <a class="anchor" href="#single-core-vs-multi-core-architecture">#</a>
</h3>
<p>We moved from single-core to multi-core processors, which made computers faster, especially by running tasks in parallel. However, this also increased complexity for developers, requiring careful optimization for efficient code execution. To understand this better, letâ€™s examine the basic structure of multi-core processors and how they handle memory and cache.</p>
<p>The following diagram illustrates the difference between a single-core processor and a multi-core processor, highlighting the relationship between CPU cores, their respective caches, and main memory.</p>
<p><img src="/diagrams/single_vs_multi_core.png" alt="Multi-Core vs Single-Core Architecture" /></p>
<h4 id="understanding-the-diagram">
  Understanding the Diagram
  <a class="anchor" href="#understanding-the-diagram">#</a>
</h4>
<p>The diagram shows two types of processors:</p>
<ol>
<li>
<p><strong>Single-Core Processor</strong></p>
<ul>
<li>Has <strong>one</strong> core handling all tasks.</li>
<li>Includes <strong>private L1 and L2 caches</strong> to store frequently used data.</li>
<li>Accesses <strong>main memory (RAM)</strong> when data is not available in the cache.</li>
</ul>
</li>
<li>
<p><strong>Multi-Core Processor</strong></p>
<ul>
<li>Has <strong>multiple cores</strong>, allowing parallel execution.</li>
<li>Each core has its <strong>own private L1 and L2 caches</strong> (as commonly seen in Intel processors).</li>
<li>An <strong>L3 cache acts as a buffer for data exchange between cores and helps reduce main memory accesses</strong>.</li>
<li>Reduces the need to access <strong>main memory</strong>, improving performance.</li>
</ul>
</li>
</ol>
<h4 id="why-this-matters">
  Why This Matters
  <a class="anchor" href="#why-this-matters">#</a>
</h4>
<p>Multi-core processors improve speed and efficiency, but they also introduce <strong>new challenges</strong> like cache coherence, false sharing, and synchronization overhead. The rest of the article will explore these issues and their impact on performance.</p>
<h3 id="checking-your-cpus-cache-configuration">
  Checking Your CPU&rsquo;s Cache Configuration
  <a class="anchor" href="#checking-your-cpus-cache-configuration">#</a>
</h3>
<p>If you have an Intel processor like mine, you can check your systemâ€™s cache configuration using the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ lscpu | grep -i cache
</span></span><span style="display:flex;"><span>L1d cache:                          <span style="color:#ae81ff">64</span> KiB <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> instances<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>L1i cache:                          <span style="color:#ae81ff">64</span> KiB <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> instances<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>L2 cache:                           <span style="color:#ae81ff">512</span> KiB <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> instances<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>L3 cache:                           <span style="color:#ae81ff">3</span> MiB <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> instance<span style="color:#f92672">)</span>
</span></span></code></pre></div><p><em>Note: This configuration is specific to my Intel processor and may differ for other models.</em></p>
<h4 id="interpretation">
  Interpretation
  <a class="anchor" href="#interpretation">#</a>
</h4>
<ul>
<li><strong>L1d &amp; L1i caches</strong>: 64 KiB each with <strong>2 instances</strong> â†’ This indicates that L1 cache is <strong>private per core</strong>.</li>
<li><strong>L2 cache</strong>: 512 KiB with <strong>2 instances</strong> â†’ Each core likely has its own private L2 cache.</li>
<li><strong>L3 cache</strong>: 3 MiB with <strong>1 instance</strong> â†’ This shows that L3 cache is <strong>shared across all cores</strong>.</li>
</ul>
<p>This system has <strong>private L1 and L2 caches per core</strong> and a <strong>shared L3 cache</strong>, which is a common configuration in modern processors like those from <strong>Intel</strong>.</p>
<h3 id="cache-sharing-and-potential-issues">
  Cache Sharing and Potential Issues
  <a class="anchor" href="#cache-sharing-and-potential-issues">#</a>
</h3>
<ul>
<li><strong>Private Caches</strong>: Cores have their own L1 and L2 caches, designed to provide fast access to frequently used data specific to each core.</li>
<li><strong>Shared Cache</strong>: The L3 cache is shared by all cores, allowing for efficient communication and data exchange between cores.</li>
</ul>
<p>However, cache sharing introduces some challenges:</p>
<h4 id="issues-in-multi-core-architectures">
  Issues in Multi-Core Architectures
  <a class="anchor" href="#issues-in-multi-core-architectures">#</a>
</h4>
<ol>
<li>
<p><strong>Cache Coherence</strong>: To ensure all cores have a consistent view of the data, cache coherence protocols (like MESI) are employed. These protocols track the state of each cache line to maintain consistency.</p>
</li>
<li>
<p><strong>False Sharing</strong>: False sharing occurs when independent variables, stored in the same cache line, are modified by different threads running on separate cores. This results in unnecessary cache invalidation, reducing performance.</p>
</li>
<li>
<p><strong>Cache Thrashing</strong>: When multiple cores frequently access and modify the same cache line, it leads to constant invalidation and reloading, significantly impacting performance.</p>
</li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#cache-hierarchy-and-sharing-in-multi-processor-machines"><strong>Cache Hierarchy and Sharing in Multi-Processor Machines</strong></a>
      <ul>
        <li><a href="#typical-cache-hierarchy">Typical Cache Hierarchy</a></li>
        <li><a href="#single-core-vs-multi-core-architecture">Single-Core vs Multi-Core Architecture</a></li>
        <li><a href="#checking-your-cpus-cache-configuration">Checking Your CPU&rsquo;s Cache Configuration</a></li>
        <li><a href="#cache-sharing-and-potential-issues">Cache Sharing and Potential Issues</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












